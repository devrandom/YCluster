---
- name: Configure Proxy Settings
  hosts: all
  become: yes
  tasks:
    - name: Add proxy hostname entries to /etc/hosts
      blockinfile:
        path: /etc/hosts
        block: |
          10.0.0.1 proxy.xc
          10.0.0.254 proxy.xc
        marker: "# {mark} ANSIBLE MANAGED BLOCK - proxy.xc"
        backup: yes

    - name: Set proxy environment variables
      lineinfile:
        path: /etc/environment
        line: "{{ item }}"
        regexp: "^{{ item.split('=')[0] }}="
        backup: yes
      loop:
        - "http_proxy=http://proxy.xc:3128"
        - "https_proxy=http://proxy.xc:3128"
        - "no_proxy=localhost,127.0.0.1,10.0.0.0/24,10.10.10.0/24"

    - name: Configure apt proxy
      copy:
        dest: /etc/apt/apt.conf.d/01proxy
        content: |
          Acquire::http::Proxy "http://proxy.xc:3128";
          Acquire::https::Proxy "http://proxy.xc:3128";
        backup: yes
