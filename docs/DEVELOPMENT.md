# YCluster Development Guide

## Dev Environment

The `./dev` directory provides a local PXE boot environment for testing autoinstall on bare metal machines.

```bash
cd dev

# Start Docker services (etcd, admin-api, nginx, squid)
docker compose up -d

# Start dnsmasq on the host (needs sudo for DHCP)
sudo ./dnsmasq-watch.sh

# PXE boot a bare metal machine on the same network
```

The admin laptop runs at 10.0.0.254. Machines PXE boot via UEFI HTTP, load GRUB, and run Ubuntu autoinstall with config generated by admin-api.

### Live Reload

Source files from `config/ansible/admin/files/` are mounted into the container:

```bash
docker compose restart admin-api
```

### Running Ansible

Set up the Python environment (once):

```bash
uv sync
source .venv/bin/activate
```

After a node is provisioned, configure it with Ansible:

```bash
cd dev/ansible
ansible-playbook prod/site.yml --limit c1
```

The `prod` symlink points to `config/ansible/`, so production playbooks run against dev nodes.

### Testing

```bash
# Test user-data generation
curl "http://10.0.0.254:9080/autoinstall/user-data?mac=aa:bb:cc:dd:ee:ff"

# View logs
docker compose logs -f admin-api
```
